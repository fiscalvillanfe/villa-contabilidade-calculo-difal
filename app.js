const fmtMoney=v=>v.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});const pct=v=>`${(v*100).toFixed(2)}%`;const UFS=["AC","AL","AM","AP","BA","CE","DF","ES","GO","MA","MG","MS","MT","PA","PB","PE","PI","PR","RJ","RN","RO","RR","RS","SC","SE","SP","TO"];function maskMoney(el){const only=el.value.replace(/[^\d]/g,'');const n=parseInt(only||'0',10)/100;el.value=n.toLocaleString('pt-BR',{minimumFractionDigits:2,maximumFractionDigits:2});}function getNumberFromBRL(s){if(!s) return 0;return Number(s.replace(/\./g,'').replace(',','.'))||0;}function fillUFs(){const o=document.getElementById('ufOrigem');const d=document.getElementById('ufDestino');o.innerHTML=UFS.map(u=>`<option value="${u}">${u}</option>`).join('');d.innerHTML=UFS.map(u=>`<option value="${u}">${u}</option>`).join('');}function calcular(e){e.preventDefault();const valor=getNumberFromBRL(document.getElementById('valor').value);const aliqInt=(Number(document.getElementById('aliqInt').value)||0)/100;const aliqInter=Number(document.getElementById('aliqInter').value||0);const fcpPct=(Number(document.getElementById('fcp').value)||0)/100;const redDestino=(Number(document.getElementById('redDestino').value)||0)/100;const base=valor*(1-redDestino);const difPct=aliqInt>0?((aliqInt-aliqInter)/(1-aliqInt)):0;const difal=base*difPct;const fcp=base*fcpPct;document.getElementById('outBase').textContent=fmtMoney(base);document.getElementById('outAliqInt').textContent=pct(aliqInt);document.getElementById('outAliqInter').textContent=pct(aliqInter);document.getElementById('outDifal').textContent=fmtMoney(difal);document.getElementById('outFcp').textContent=fmtMoney(fcp);document.getElementById('rowBase').textContent=fmtMoney(base);document.getElementById('rowPct').textContent=(difPct*100).toFixed(2)+'%';document.getElementById('rowDifal').textContent=fmtMoney(difal);document.getElementById('rowFcp').textContent=fmtMoney(fcp);document.getElementById('cards').classList.remove('hidden');document.getElementById('detalhe').classList.remove('hidden');const resumo=[`Base no destino: ${fmtMoney(base)}`,`Alíquota interna: ${(aliqInt*100).toFixed(2)}%`,`Alíquota interestadual: ${(aliqInter*100).toFixed(2)}%`,`Diferença de alíquotas por dentro: ${(difPct*100).toFixed(2)}%`,`DIFAL devido ao destino: ${fmtMoney(difal)}`,`FCP: ${fmtMoney(fcp)}`].join('\n');document.getElementById('btnCopy').onclick=async()=>{try{await navigator.clipboard.writeText(resumo);alert('Resumo copiado!');}catch{alert('Não foi possível copiar.');}};const params=new URLSearchParams({valor:valor,aliqInt:aliqInt,aliqInter:aliqInter,fcp:fcpPct,redDestino:redDestino});document.getElementById('btnShare').href=location.origin+location.pathname+'?'+params.toString();}
function restoreFromURL(){const q=new URLSearchParams(location.search);if(!q.has('valor')) return;document.getElementById('valor').value=Number(q.get('valor')||0).toLocaleString('pt-BR',{minimumFractionDigits:2,maximumFractionDigits:2});document.getElementById('aliqInt').value=((Number(q.get('aliqInt'))||0)*100).toFixed(2);document.getElementById('aliqInter').value=q.get('aliqInter')||'';document.getElementById('fcp').value=((Number(q.get('fcp'))||0)*100).toFixed(2);document.getElementById('redDestino').value=((Number(q.get('redDestino'))||0)*100).toFixed(2);}document.getElementById('valor').addEventListener('input',e=>maskMoney(e.target));document.getElementById('form').addEventListener('submit',calcular);document.getElementById('form').addEventListener('reset',()=>{document.getElementById('cards').classList.add('hidden');document.getElementById('detalhe').classList.add('hidden');});fillUFs();restoreFromURL();
